# 緊急避難所ナビ

位置情報とDeviceOrientation APIを使用して、最寄りの緊急避難所を矢印で指し示すWebアプリケーションです。

## 機能

- 現在地から最寄りの避難所を自動検索（**3件同時表示**）
- DeviceOrientation APIで端末の向きを判定
- **円形コンパス**上に3つの矢印を配置
  - 矢印は実際の方角に基づいて円周上に配置
  - 端末を回転させると矢印も相対的に移動
- **コンパス針**が常に北を指して方角を表示
- 各避難所の距離と方角をカード形式で表示
- 矢印は色とサイズで優先度を表示（赤・大 → オレンジ・中 → 黄・小）
- スマートフォンに最適化されたレスポンシブUI
- 詳細なデバッグログで問題診断が容易

## 使用技術

- **Geolocation API**: 現在地の取得
- **DeviceOrientation API**: 端末の向き（コンパス）の取得
- **jp-shelter-api**: 全国の避難所データ取得
- **OpenStreetMap Nominatim**: 位置情報から市区町村の特定

## セットアップ

1. ファイルをWebサーバーに配置
2. スマートフォンのブラウザでアクセス

```bash
# 開発用サーバーの起動例
python -m http.server 8000
```

3. `https://localhost:8000`にアクセス（HTTPS必須）

## 必要な権限

- 位置情報へのアクセス
- モーションセンサー/コンパスへのアクセス（iOS 13+）

## 使い方

1. アプリを開くと自動的に位置情報と避難所データを取得
2. 端末を水平に保つ
3. **円形コンパス**を確認
   - 円の中心があなたの現在地
   - 赤い針（N）が北の方角を指す
   - **3つの矢印**が最寄り3件の避難所の実際の方角を指す
     - **赤色（大）**: 最寄りの避難所
     - **オレンジ（中）**: 2番目に近い避難所
     - **黄色（小）**: 3番目に近い避難所
4. 端末を回転させると、矢印とコンパス針も連動して回転
5. 各避難所の詳細情報（名称、距離、方角、住所）をカードで確認
6. 選んだ矢印の方向に進むと避難所に到着

## デバッグ方法

ブラウザの開発者ツール（コンソール）で以下の情報を確認できます：
- `Geocoding結果（フル）`: 取得した位置情報の詳細
- `抽出結果 - 市区町村: xxx 都道府県: xxx`: 特定した市区町村
- `最寄りの避難所3件`: 検索結果の上位3件

## 対応ブラウザ

- iOS Safari 13+
- Android Chrome 最新版
- その他のモダンブラウザ

## 注意事項

- HTTPSでの配信が必須（位置情報とDeviceOrientation APIの要件）
- 屋内や電波状況が悪い場所では精度が低下する可能性があります
- コンパスの精度は端末に依存します
- 避難所データは各自治体が公開しているものを使用

## ファイル構成

```
├── index.html    # メインHTML
├── style.css     # スタイルシート
├── app.js        # アプリケーションロジック
└── README.md     # このファイル
```

## API仕様

### jp-shelter-api

- エンドポイント: `https://motohasystem.github.io/jp-shelter-api/api/v0/{type}/{cityCode}.json`
- `type`: `emergency` (緊急避難場所) または `evacuation` (指定避難所)
- `cityCode`: 6桁の市区町村コード

### OpenStreetMap Nominatim

- 逆ジオコーディングに使用
- エンドポイント: `https://nominatim.openstreetmap.org/reverse`

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## データソース

- 避難所データ: [jp-shelter-api](https://github.com/motohasystem/jp-shelter-api)
- 地図データ: OpenStreetMap contributors
